pool:
  vmImage: ubuntu-latest

variables:
  VERSION_TAG: '0.12.0'
  containerRegistry: 'Container Registry - piosupportacr'
  containerRegistryFullName: 'piosupportacr.azurecr.io'
  repository: 't-rex'


steps:
  # Create Timestamp pipeline variable
  - script: |
      echo "##vso[task.setvariable variable=timeStamp]$(date +%y%m%d%H%M%S)"

  - task: Docker@2
    inputs:
      displayName: Docker Build
      containerRegistry: $(containerRegistry)
      repository: 't-rex'
      command: 'build'
      arguments: --build-arg VERSION_TAG='$(VERSION_TAG)'
      Dockerfile: 't-rex/Dockerfile'
      tags: |
        $(VERSION_TAG)-$(timeStamp)
        $(VERSION_TAG)-test
        latest

  - task: Docker@2
    inputs:
      displayName: Docker Pusg (Test Image)
      containerRegistry: $(containerRegistry)
      repository: 't-rex'
      command: 'push'
      tags: |
        $(VERSION_TAG)-test


  # - task: Docker@2
  #   displayName: Test
  #   inputs:
  #     command: login
  #     containerRegistry: $(containerRegistry)
  # - script: |
  #     # docker run my-registry.azurecr.io/somerepo/rnd-hello:latest
  #     docker run $(containerRegistryFullName)/$(repository):test

  # - task: Docker@2
  #   inputs:
  #     containerRegistry: $(containerRegistry)
  #     repository: 't-rex'
  #     command: 'push'
  #     tags: |
  #       $(VERSION_TAG)
  #       $(Build.BuildId)-$(Release.Deployment.StartTime)
  #       latest


